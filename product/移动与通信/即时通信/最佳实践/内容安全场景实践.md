若您希望对即时通信 IM 系统中的用户资料、群组资料、单聊消息、群聊消息等内容进行内容安全审核，针对不安全、不适宜的消息内容进行自动识别、处理。推荐您使用即时通信 IM 的内容回调，并自行接入第三方内容安全产品（例如：[腾讯云内容安全产品](https://cloud.tencent.com/product/tms)），为您的产品体验和业务安全保驾护航。 

>!1、“内容回调”与“发消息前回调”不同：
（1）“内容回调”比“发消息前回调”覆盖的审核场景更多。“内容回调”不仅支持单聊、群聊场景，还支持资料、关系链、群资料、群成员资料等场景；
（2）“内容回调”比“发消息前回调”的延迟更低。“内容回调”通过直接对接第三方内容安全平台（例如：[腾讯云内容安全产品](https://cloud.tencent.com/product/tms)）的方式，可针对图文同步审核，大大缩短了接入流程，无需额外开发，而且延迟更低。
2、即时通信 IM 的内容回调功能需要 [申请开通](https://cloud.tencent.com/document/product/269/3916?from=17212) 后使用。


## 实现流程
“内容回调”实现流程：
由客户端发起的消息，通过 IM SDK 发送至 IM 后台，同时通过内容回调，将消息内容抄送至第三方内容安全服务，进行判断，将判断结果告知 IM 后台是否下发。如下图所示：
![](https://qcloudimg.tencent-cloud.cn/raw/fa03dca021daecbb87177183413f9f7f.png)
相比于“发消息前回调”（如下图所示），“内容回调”的实现流程更短，接入更便捷，延迟更低。
![](https://qcloudimg.tencent-cloud.cn/raw/fde5bc51aa0a7be59ff90529d50d1465.png)

>!
>1. 文本同步审核，拦截后会向 SDK 返回80001的错误码，450ms超时。
>2. 图片默认异步审核，拦截后会封禁文件，后续下载不到违规文件，但图片可以配置 URL 时支持同步审核，拦截后会向 SDK 返回80004的错误码，2s超时。
>3. 音视频异步审核，拦截后会封禁文件，后续下载不到违规文件。


## 实践效果（举例）
<dx-tabs>
::: 发送端
识别到非正常消息，阻止发送。
<img style="width:400px; max-width: inherit;" src="https://qcloudimg.tencent-cloud.cn/raw/b0343d37bb8cf3bc63e69158bbb75684.jpeg" />
:::
::: 接收端
未接收到非正常消息。
<img style="width:400px; max-width: inherit;" src="https://qcloudimg.tencent-cloud.cn/raw/325e4a63688dcf5e06197a54953dbfee.jpeg" />
:::
</dx-tabs>



## 快速接入
### 步骤1：申请开通内容回调功能
按照 [申请开通](https://cloud.tencent.com/document/product/269/3916?from=17212) 文档指引，完成申请操作，申请通过后可使用内容回调功能。

### 步骤2：获取内容回调 URL 和 Token
从第三方内容安全产品处获取内容回调 URL和 Token。
目前市面上已有较多第三方内容安全产品，您可以自行了解，同时您也可以看看腾讯云内容安全产品能否符合您的要求。

### 步骤3：进行内容回调配置
根据您业务诉求，将从第三方内容安全产品（例如：[腾讯云内容安全产品](https://cloud.tencent.com/product/tms)）获取的内容回调 URL 和 Token 填写至 [即时通信 IM 控制台](https://console.cloud.tencent.com/im/callback-setting)。详细步骤如下：
1. 进入 即时通信 IM 控制台 > 回调配置 > [内容回调配置](https://console.cloud.tencent.com/im/callback-setting)，单击页面内模块右上角的“编辑”。
![](https://qcloudimg.tencent-cloud.cn/raw/6e90479c58c3b49b655a0ff9bde25b2e.png)
2. 在“编辑”弹窗中，填入从第三方内容安全产品处获取的内容回调 URL 和 Token，并勾选需要生效的回调内容类型，单击**确定**。
![](https://qcloudimg.tencent-cloud.cn/raw/c3d8ab169b59821a012b4d48b8ce4a3f.png)
>!同一内容回调 URL 和 Token，可填写至多个 IM 应用的多个内容回调配置模块内。
3. 查看回调配置和已生效回调内容类型/回调字段。
![](https://qcloudimg.tencent-cloud.cn/raw/28bbcf67b36e82d0a10f13441685afdd.png)


## 常见问题
### 为什么在控制台上看不到“内容回调”页面？
即时通信 IM 的内容回调功能需要 [申请开通](https://cloud.tencent.com/document/product/269/3916?from=17212) 后使用，申请开通后即可看到“内容回调”页面。
### 什么场景下选择“内容回调”，什么场景下选择“发消息前回调”？
若您需要覆盖资料、关系链、群资料、群成员资料等场景的内容审核，请选择“内容回调”；若您想针对图文同步审核，且有降低延迟的诉求，请选择“内容回调”；其他情况下，您可选择“发消息前回调”。
### 怎么配置图片的同步审核？
在 URL 的配置中添加 URL 参数SyncImage，即 URL 添加一个 &SyncImage 的后缀就可以支持图片同步送审了。
### 内容回调的结果怎么通知到客户侧？
后续支持将内容回调的结果通过普通回调的形式通知客户侧，预计8月中旬上线。
