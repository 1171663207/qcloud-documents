# 版本与路由配置

## 一、什么是版本

网关所有影响流量、路由行为的配置，均属于版本范畴内。您需要通过发布新版本来更新现有的流量、路由配置。

发布版本过程中，支持灰度能力，您可以先切换较少的流量验证新版本配置，然后再切换更多流量，直到全量发布。

## 二、创建网关版本

在网关详情页内，点击新建版本，在版本中可填写版本描述并配置路由：

![](https://qcloudimg.tencent-cloud.cn/raw/ffa938e2592615b366fc3ef41b980a5e.png)

一个版本可以有多个路由，点击新建路由即可创建。每个路由主要有3个主要配置：

<img style="width:500px" src="https://7a7a-zzirali-7gjlfmcv2e2df47f-1258016615.tcb.qcloud.la/cloudbase-cms/upload/2021-12-07/WZtbkuvPeWD4-vpwYe1rgcuRtbtVo0qT_.png"/>

- 协议：http或https，网关将以对应的协议转发请求，推荐使用https；
- 域名：网关通过对应域名来匹配路由规则，以及转发请求。
- 后端服务IP：网关会把匹配到的请求转发请求到后端服务IP；如果不填写，则会直接转发至对应的域名。

>? 如果域名或IP需要通过公网访问，请先在网关所在的VPC网络内配置NAT网关。

## 三、版本流量配置、灰度发布

配置路由后，创建版本，路由配置将被固化到版本，一个网关可以创建多个版本，您可以随时进行版本流量控制，来做网关配置的升级

<img style="width:500px" src="https://7a7a-zzirali-7gjlfmcv2e2df47f-1258016615.tcb.qcloud.la/cloudbase-cms/upload/2021-12-07/zBgNM4VVlg4bECgxr4rPnzZwExdE-EDU_.png"/>
