## 云开发控制台中的云托管

### 服务名称

环境下服务的唯一标识。创建成功后**不支持修改服务名称**。如果您有多个环境，不同环境之间服务可以重名。（例如：开发环境和测试环境可以同时存在服务 "testservice"）。

### 备注信息

展示在服务列表页面，仅您自己在控制台可见，不对部署产生任何影响。

### 所在私有网络/云托管网络/子网

#### 背景知识

关于什么是私有网络（VPC）及子网，请参见 [私有网络](https://cloud.tencent.com/document/product/215) 文档。单击服务所在私有网络的名称，可以跳转到 [私有网络控制台](https://console.cloud.tencent.com/vpc) 查看私有网络的详情，以及该私有网络内您还有哪些其他云资源，可以与此私有网络内的云托管服务配合使用。

#### 使用限制

- 如果您的服务需要访问腾讯云数据库或其他云服务，您可以将这些外部依赖部署于同个私有网络中。
- **不支持更换服务所在私有网络**，您可以在正确的私有网络下重新创建服务后，再删除当前服务。

#### 用法推荐

- 新建本环境内首个服务，且无特别的网络要求，请选择“系统创建”，云托管会自动为您创建并配置好一个全新的 VPC，同时**自动创建一个全新的微小型 NAT 网关**，保证您新建的服务具备访问公网的能力。
- 新建本环境内的第 2 ～第 N 个服务，且无特别的网络要求，推荐选择和前一个服务相同的私有网络。
- 如果有明确的网络要求，请选择“已有私有网络”，指定符合您要求的 VPC 及子网。

>? 若您选择的 VPC 不是由云托管创建的，需要您自行在此 VPC 中配置 NAT 网关，否则您的服务将无法访问公网。

### NAT 网关

#### 背景知识

关于什么是 NAT 网关及如何配置公网访问，请参见 [NAT 网关](https://cloud.tencent.com/document/product/552) 文档。

#### 使用限制

- 云托管自动创建的 NAT 网关（含“系统创建”标签），为云托管定制的微小型网关，最大并发数 10 万，最高带宽 10Mbps。如果不满足您的使用需求，请前往 [NAT 网关控制台](https://console.cloud.tencent.com/vpc/nat) 新增并配置符合您要求的 NAT 网关。
- 非云托管创建的 NAT 网关，在云托管控制台无法展示 IP，费用由 NAT 网关侧进行结算。请前往 [NAT 网关控制台](https://console.cloud.tencent.com/vpc/nat) 查看并管理。

#### 用法推荐

NAT 网关 IP，将作为您的服务访问公网的出口 IP，也可用作域名备案。但无法通过这个 IP 访问到您的服务。

### 域名备案

#### 背景知识

关于什么是域名备案及如何进行域名备案，请参见 [域名备案](https://cloud.tencent.com/document/product/1243/49364) 文档。

#### 使用限制

2021年8月5日后，云托管暂停支持新增的域名备案。存量已备案用户不受影响。

### 镜像仓库


#### 背景知识

云托管使用的是容器镜像服务（TCR）个人版，没有费用。您可以在服务详情页面中的**镜像**选项卡中，快速查看当前服务所绑定的镜像仓库中所有镜像和它们的使用情况。更多关于腾讯云镜像仓库的介绍，请参见 [容器镜像服务](https://cloud.tencent.com/document/product/1141) 文档。

#### 使用限制

- 服务在创建时会绑定一个唯一的腾讯云镜像仓库，管理该服务下的所有版本的相关镜像。
- 不支持同一服务绑定多个镜像仓库，使得不同版本的镜像分散在多个不同的镜像仓库里。
- 所有由云托管创建的镜像仓库都会统一存放于以 “tcb” 开头的同一个命名空间之下，并以环境 id\_ 服务名的格式命名。您可以在 [容器镜像服务控制台](https://console.cloud.tencent.com/tcr) 上看到由云托管创建的这个镜像仓库并对它进行管理。
- 暂不支持服务绑定公有仓库。

#### 用法推荐

“使用系统默认仓库（推荐）”：创建服务时，云托管将自动为您创建一个与服务同名的私有仓库并与您的服务进行绑定。“绑定已有腾讯云镜像仓库”适用以下场景：
##### 跨场景复用
   在云托管的场景之外，您已经使用了腾讯云的镜像仓库，并希望里面的镜像继续用于云托管的某个服务。此时，在创建服务时，可以选择 “绑定已有腾讯云镜像仓库” ，指定任意您账户下的私人镜像仓库。
   请注意，若如此做，则您通过云托管产生的镜像（手动上传或自动构建推送），可能也会影响您在其他场景下的镜像使用。

##### 多个服务共用同一套代码/镜像
   如果同一个服务需要同时部署 N (N>=2) 套（在同一环境部署多套请用不同服务名加以区分，分别部署在不同环境服务可以重名），则在创建第 2 - N 个服务时，可以选择“绑定已有腾讯云镜像仓库”，并指定第一个服务所绑定的镜像仓库，实现镜像在多个服务间的复用。
   两个服务都绑定到了同一个镜像仓库，仓库中所有的镜像可以同时用于两个服务，且这两个服务未来由云托管自动构建的镜像都会被推送到这同一个镜像仓库。

#### 特殊情况

如果您曾经创建了一个服务并选择 “使用系统默认仓库” ，后来又删除了这个服务，但保留了这个同名的镜像仓库。则当您在同一环境再次用同样的名字创建服务时，选择 “使用系统默认仓库” 会自动绑定到原有的这个同名镜像仓库，而不会再次创建一个全新的镜像仓库。

此时，若您愿意继续使用之前同名服务遗留的镜像，可直接开始使用；若您不再需要遗留的镜像，请您到服务详情页面的 “镜像” 选项卡中，或到 [容器镜像服务控制台](https://console.cloud.tencent.com/tcr) 手动删除不需要的镜像。

### 日志管理/日志设置

#### 背景知识

如何在云开发控制台内查询服务日志，请参见 [服务日志查询](https://cloud.tencent.com/document/product/1243/46132)。关于腾讯云 Elasticsearch service 的介绍，请参见 [Elasticsearch service](https://cloud.tencent.com/document/product/845) 文档。

#### 使用限制

- 服务可以选择将日志输入到云开发“日志管理”模块中，或输出到指定的 ES 中。创建服务成功后**不支持修改日志选项**。
- 选择“自定义 Elasticsearch”，则在云开发或云托管控制台上无法查看您的服务日志，请前往[Elasticsearch service 控制台](https://console.cloud.tencent.com/es) 查看。

### 服务域名

- 默认公网域名：公网任意来源可以用来对服务进行 HTTPS 调用，会产生相应的公网流量费用。
- 允许公网通过服务域名访问服务：关闭后，通过默认公网域名/自定义公网域名访问服务将报错。

### HTTP 访问服务配置

在服务域名之外，可选择性启用 HTTP 访问服务。

#### 背景知识

关于云开发 HTTP 访问服务的介绍，请参见 [HTTP 访问服务文档](https://cloud.tencent.com/document/product/876/41728)。

#### 使用限制

- 是否启用、如何配置 HTTP 访问服务，均不影响对服务域名的使用。
- 关闭“允许公网通过服务域名访问服务”开关，不影响公网通过在 HTTP 访问服务中配置的地址访问服务。
- 公网通过在 HTTP 访问服务中配置的地址访问服务，会产生相应的公网流量费用。


## 云托管独立控制台

### 服务名称

环境下服务的唯一标识。创建成功后**不支持修改服务名称**。如果您有多个环境，不同环境之间服务可以重名。（例如：开发环境和测试环境可以同时存在服务 "testservice"）。服务名只能包含数字、小写字母和‘-’，且必须以小写字母开头。

### 部署方式

支持上传代码包/拉取镜像两种方式。

#### 方式 1：上传代码包

上传代码工程文件夹或 zip 压缩包，系统解析成功后先将代码构建为镜像、将镜像推送到镜像仓库储存，然后基于该镜像进行部署。

**此方式需要您自行编写 Dockerfile 并包含在代码文件夹或 zip 压缩包中。**

#### 方式 2：拉取镜像

无需系统提供从代码构建镜像的服务，由您自行采用任意方式构建好镜像后，手动将镜像上传至腾讯云容器镜像服务中，然后系统基于您选定的镜像进行部署。

>? 
> 如何使用容器镜像服务，请查看[容器镜像服务文档](https://cloud.tencent.com/document/product/1141/39287)。
> 

### 端口

服务的监听端口，不支持多个。此端口不是对外暴露的端口（服务的调用方无需感知和使用此端口）。

### 环境变量

用户所需的环境变量，直接传入容器中。以 key value 的形式可配置多个。适合用来管理一些可变的配置，使得可以在不重新部署服务的情况下改变某些参数，例如数据库地址等。

### 目标目录
当代码包中包含不需要构建的文件时（例如同一个代码包中包含多个服务的代码，当前服务只用到其中一个子目录；或者需要排除README等文件时），可以将对应需要构建的子目录指定为目标目录，则不在目标目录中的文件会被忽略。
**Dockerfile需要位于目标目录的根目录下，否则会报错。**

### Dockerfile名称
默认为"Dockerfile"。当同一份代码在不同场景时需要配套使用不同的Dockerfile，就需要用不同名称区分Dockerfile。

### 公网访问
关闭后，默认域名/自定义域名均不可访问。服务只能对内使用。

### 默认域名
服务创建后即分配的系统默认域名，仅能支持测试使用，不承诺SLA及相关补偿，请勿用于线上生产。线上业务请绑定并使用自定义域名。

### 自定义域名
绑定您自行购买和已备案好的域名（不一定要在腾讯云购买及备案），一个服务可以绑定多个，但多个服务不能绑定同一个自定义域名。

### 容器规格
每个容器实例的配置。自动扩容时，新创建的实例也将使用这个规格。同一个服务下所有运行中的容器实例规格都会保持一致。可选的容器规格范围由当前环境所选套餐决定。
**容器规格不会随着扩缩容而改变**。

### 日志采集类型
选择“自定义”，则将日志采集到[腾讯云日志服务CLS](https://console.cloud.tencent.com/cls)中。

### 日志采集路径
使用云托管不需要登陆到机器/实例上去看日志，而是将日志采集后直接在控制台查看。可设置目录或文件，支持设置多个路径，支持标准输出（stdout）以及 `*` 通配路径（例：/logs/\*），使用 `,`（半角逗号）分割，留空将采集标准输出。

### 实例副本数

指当前服务在自动扩缩容时可达到的最大实例数及最小实例数。最小值下限为 0，最大值上限由当前环境所选套餐决定。
- 副本个数最小值为 0，当连续半小时**没有通过域名调用服务时**，版本将缩容到 0，不保留任何实例，不产生资源消耗。再次冷启动时，可能有一定的服务延迟。
- 虽然没有业务流量，部署过程中仍然会先产生一个实例，部署完成后再缩容到 0，因此**部署过程本身会产生一定的资源消耗。**
- 副本个数最小值不为 0，即便服务没有任何访问，仍会保持最小个数的实例数，也会**持续产生资源消耗**。

### 扩缩容条件

当达到某个条件时，云托管会自动会创建/删除实例，然后检测是否再次达到条件，如果满足条件则继续扩缩容，如此反复直至实例数量达到副本个数的最小值/最大值，或不再满足扩缩容条件时停止自动扩缩容。目前支持 CPU 使用率/内存使用率作为扩缩容条件，更多扩缩容指标敬请期待。

>? 
>自动扩容到副本个数最大值后若仍不足以承载业务流量，即便再次达到扩缩容条件，也不会继续创建新的实例，可能导致您的业务受影响，请您评估好业务指标后合理设定副本个数最大值。
> 


