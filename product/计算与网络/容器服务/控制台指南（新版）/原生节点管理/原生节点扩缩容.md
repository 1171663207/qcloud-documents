
## 使用说明
- 原生节点的自动伸缩功能由容器平台自研实现，普通节点的自动伸缩功能依赖云产品 弹性伸缩 AS。
- 原生节点池未开启自动伸缩：
	- 初始化节点数量取决于设置的【节点数】（字段名：replicas）；
	- 用户可以手动调整期望节点数，节点数上限受限于后台默认值 500和容器子网IP数；
- 原生节点池开启自动伸缩：
	- 初始化节点数量取决于设置的【节点数】（字段名：replicas），
	- 需要设置【节点数量范围】（字段名：minReplicas/maxReplicas），CA 调节当前节点池的节点数量受限于该范围；
	- 不支持用户手动调节期望实例数；

## 为节点开启自动伸缩功能

| 功能项       | 字段名/值                                                    | 描述                                                         |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 自动伸缩     | 字段名：spec.scaling                                         | 默认勾选开启，开启后 CA 组件对该类节点池进行自动伸缩。       |
| 节点数量范围 | 字段名：spec.scaling.maxReplicas/minReplicas<br>字段值：自定义 | 节点池内的节点数量受限于该范围内的最小值/最大值，若节点池开启了自动伸缩，原生节点数量将在设定的范围内自动调节。 |
| 扩容策略     | 字段名：spec.scaling.createPolicy<br>字段值：<li>ZonePriority（首选可用区优先） <li>ZoneEquality（多可用区打散） | <li>首选可用区优先：弹性伸缩会在您首选的可用区优先执行扩缩容。若首选可用区无法扩缩容，才会在其他可用区进行扩缩容。<li>多可用区打散：在伸缩组指定的多可用区（即指定多个子网）之间尽最大努力均匀分配节点实例。只有配置了多个子网时该策略才能生效。 |


### 通过控制台操作
- 通过节点池【创建页】开启或关闭自动伸缩；
![](https://qcloudimg.tencent-cloud.cn/raw/27744b1194be94a491ed20e7acad50a0.png)

- 通过节点池【详情页】开启或关闭自动伸缩；
![](https://qcloudimg.tencent-cloud.cn/raw/dee050903bda77224fae77a2d4774869.png)

### 通过YAML操作
请根据参数介绍，在节点池YAML中填写`scaling`字段。

```
apiVersion: node.tke.cloud.tencent.com/v1beta1
kind: MachineSet
spec:
  type: Native
  displayName: mstest
  replicas: 2
  autoRepair: true
  deletePolicy: Random
  healthCheckPolicyName: test-all
  instanceTypes:
  - C3.LARGE8
  subnetIDs:
  - subnet-xxxxxxxx
  - subnet-yyyyyyyy
  scaling:
    createPolicy: ZonePriority
    minReplicas: 10
    maxReplicas: 100
  template:
    spec:
      displayName: mtest
      runtimeRootDir: /var/lib/containerd
      unschedulable: false
......

```

### 查看扩缩容记录
您可在节点池详情页的【运维记录】中查看扩缩容记录。
![](https://qcloudimg.tencent-cloud.cn/raw/8ea84493ab69f4c9ed55de00195ff2d3.png)
