## 操作场景
 
本文主要面向腾讯内部自研上云用户如何迁移至微服务引擎托管的 PolarisMesh 治理中。

## 前提条件

- 已创建 PolarisMesh 服务治理中心，请参见 [创建 PolarisMesh 治理中心](https://cloud.tencent.com/document/product/1364/65866)。


## 操作步骤

1. 登录 [TSE 控制台](https://console.cloud.tencent.com/tse)。
2. 在**治理中心**下的 **polarismesh** 页面，单击页面左上方下拉列表，选择目标地域。
3. 单击目标引擎的“ID”，进入基本信息页面。

### 创建**polaris.discover**服务

#### 未开启公网
1. 在实例的基本信息页面中，记住访问地址中的每个VPC内网IP地址以及访问端口
![](https://qcloudimg.tencent-cloud.cn/raw/ac156fe7007b43ebd91bba186e71e87d.png)
2. 针对每一个内网VPC的IP地址，在命名空间**Polaris**下创建服务**polaris.discover-{vpc 名称}**
 ![](https://qcloudimg.tencent-cloud.cn/raw/6f1ace02cca38bd57d420c8585f2a2a6.png)
3. 点击服务**polaris.discover-{vpc 名称}**，进入到服务的实例页面，根据对应上述第三步所记录的VPC内网IP地址以及端口协议**grpc**、**trpc**分别创建实例
 ![](https://qcloudimg.tencent-cloud.cn/raw/55cde3efcee6abe11117ca2dc94790b4.png)
4. 按照上述步骤的操作，最终服务**polaris.discover-{vpc 名称}**的实例列表如下
 ![](https://qcloudimg.tencent-cloud.cn/raw/271aa62d54d96e8e148114bedf17a529.png)
5. 如果使用的是**polaris-go**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
    global:
     system:
       discoverCluster:
         namespace: Polaris
         service: polaris.discover-{vpc 名称}
    ```
6. 如果使用的是**polaris-java**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
     global:
       system:
         discoverCluster:
           namespace: Polaris
           service: polaris.discover-{vpc 名称}
           sameAsBuiltin: false
    ```

#### 开启公网

1. 在实例的基本信息页面中，记住访问地址中的公网IP地址以及访问端口
 ![](https://qcloudimg.tencent-cloud.cn/raw/47e0ef859b9dccfde2b3754fd05699cd.png)
2. 在命名空间**Polaris**下创建服务**polaris.discover**
 ![](https://qcloudimg.tencent-cloud.cn/raw/9380435875dcc61976065e7a6c2f6ad8.png)
3. 点击服务**polaris.discover**，进入到服务的实例页面，根据客户端公网IP地址以及端口协议**grpc**、**trpc**分别创建实例
 ![](https://qcloudimg.tencent-cloud.cn/raw/4160a80cca8e48af28f580dcc11ba862.png)
4. 按照上述步骤的操作，最终服务**polaris.discover**的实例列表如下
 ![](https://qcloudimg.tencent-cloud.cn/raw/1cf3e2176a6fa7638f07b13dfe5ac3b3.png)
5. 如果使用的是**polaris-go**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
    global:
     system:
       discoverCluster:
         namespace: Polaris
         service: polaris.discover
    ```
6. 如果使用的是**polaris-java**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
     global:
       system:
         discoverCluster:
           namespace: Polaris
           service: polaris.discover
           sameAsBuiltin: false
    ```

### 创建**polaris.healthcheck**服务

#### 未开启公网
1. 在实例的基本信息页面中，记住访问地址中的每个VPC内网IP地址以及访问端口
![](https://qcloudimg.tencent-cloud.cn/raw/ac156fe7007b43ebd91bba186e71e87d.png)
2. 针对每一个内网VPC的IP地址，在命名空间**Polaris**下创建服务**polaris.healthcheck-{vpc 名称}**
![](https://qcloudimg.tencent-cloud.cn/raw/cec65b90f8d68cbaab243c51b5af7d49.png)
3. 点击服务**polaris.healthcheck-{vpc 名称}**，进入到服务的实例页面，根据对应上述第三步所记录的VPC内网IP地址以及端口协议**grpc**、**trpc**分别创建实例
![](https://qcloudimg.tencent-cloud.cn/raw/d123c305d51ba2f345dcbbaf74e41be8.png)
4. 按照上述步骤的操作，最终服务**polaris.healthcheck-{vpc 名称}**的实例列表如下
![](https://qcloudimg.tencent-cloud.cn/raw/7ab5e26730fff7183ef3d695ac8f23e1.png)
5. 如果使用的是**polaris-go**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
    global:
     system:
       healthCheckCluster:
         namespace: Polaris
         service: polaris.healthcheck-{vpc 名称}
    ```
6. 如果使用的是**polaris-java**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
     global:
       system:
         healthCheckCluster:
           namespace: Polaris
           service: polaris.healthcheck-{vpc 名称}
           sameAsBuiltin: false
    ```

#### 开启公网
1. 在实例的基本信息页面中，记住访问地址中的公网IP地址以及访问端口
![](https://qcloudimg.tencent-cloud.cn/raw/47e0ef859b9dccfde2b3754fd05699cd.png)
2. 针对每一个内网VPC的IP地址，在命名空间**Polaris**下创建服务**polaris.healthcheck**
![](https://qcloudimg.tencent-cloud.cn/raw/6aea98ab8444f4661120c67f8e01ff47.png)
3. 点击服务**polaris.healthcheck**，进入到服务的实例页面，根据客户端公网IP地址以及端口协议**grpc**、**trpc**分别创建实例
![](https://qcloudimg.tencent-cloud.cn/raw/67719dc73f4579dc5fec14c20dd678c2.png)
4. 按照上述步骤的操作，最终服务**polaris.healthcheck**的实例列表如下
![](https://qcloudimg.tencent-cloud.cn/raw/1f7ce0960f4e2a1d73294ec39abed404.png)
5. 如果使用的是**polaris-go**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
    global:
     system:
       healthCheckCluster:
         namespace: Polaris
         service: polaris.healthcheck
    ```
6. 如果使用的是**polaris-java**的话，则**polaris.yaml**中按照下面示例进行配置二次寻址
    ```yaml
     global:
       system:
         healthCheckCluster:
           namespace: Polaris
           service: polaris.healthcheck
           sameAsBuiltin: false
    ```